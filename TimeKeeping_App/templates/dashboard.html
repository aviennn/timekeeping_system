{% extends 'base.html' %}

{% block title %}
    User Dashboard
{% endblock %}

{% block content %}
    <div id="clock"></div>

    {% if not current_employee %}
    <form method="post">

        <div class="form-group">
            <label for="employee">Select Employee</label>
            {% csrf_token %}
            <select class="form-control" id="employee" name="employee" required>
                <option value="">Select Employee</option>
                {% for employee in employees %}
                <option value="{{ employee.id }}">{{ employee.username }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="password-container">
            <div class="input-group">
                <input type="password" class="form-control" id="password" name="password" placeholder="Enter your password" required>
                <div class="input-group-append">
                    <span class="input-group-text bg-white">
                        <i id="eye-icon" class="fas fa-eye" onclick="togglePassword()" style="cursor: pointer;"></i>
                    </span>
                </div>
            </div>
        </div>         
        
        <button class="btn btn-primary" type="submit">Login</button>
    </form>
    {% endif %}

    {% if current_employee %}
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="employee" value="{{ current_employee.id }}">
        <input type="hidden" name="password" value="{{ current_employee.password }}">
        <button class="btn" name="action" value="morning_in">Morning In</button>
        <button class="btn" name="action" value="morning_out">Morning Out</button>
        <button class="btn" name="action" value="afternoon_in">Afternoon In</button>
        <button class="btn" name="action" value="afternoon_out">Afternoon Out</button>
    </form>

    <table class="table table-striped table-responsive">
        <thead>
            <tr>
                <th>Name</th>
                <th>Date</th>
                <th>Morning In</th>
                <th>Morning Out</th>
                <th>Lunch Break Hours</th>
                <th>Afternoon In</th>
                <th>Afternoon Out</th>
                <th>Total Hours</th>
            </tr>
        </thead>
        
        <tbody>
            {% for record in time_records %}
            <tr>
                <td>{{ record.employee.username }}</td>
                <td>{{ record.date }}</td>
                <td>{{ record.morning_time_in|time:"g:i:s A" }}</td>
                <td>{{ record.morning_time_out|time:"g:i:s A" }}</td>
                <td>{{ record.lunch_break_hours }}</td>
                <td>{{ record.afternoon_time_in|time:"g:i:s A" }}</td>
                <td>{{ record.afternoon_time_out|time:"g:i:s A" }}</td>
                <td>{{ record.total_hours }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <a href="{% url 'export_pdf' %}" class="btn">Export to PDF</a>

    <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit" class="btn">Logout</button>
    </form>
    {% endif %}
{% endblock %}